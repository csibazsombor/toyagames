<!DOCTYPE html>
<html lang="en">
<head manifest="app_cache.appcache">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CIKOIN - Menu</title>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="../../CSS/fonts.css">
</head>
<body>  

<div class="menu" id="menu">
        <div class="who-plays" id="who-plays">
          <h1>CIKOIN<sub style="font-size: 0.35cm;">MEOW</sub></h1>
                 
          <select name="" id="who-play">
                  <option value="">Who Plays?</option>
                  <option value="Toye">Toye</option>
                  <option value="Toya">Toya</option>
          </select>
          <input type="button" value="Play" onclick="start()">
        </div>
        
        <div class="loading" id="loading">
          <h1>loading..</h1>
        </div>

        <div class="characters" id="characters">
         Select Character
          <select name="" id="character-select" class="character-select" onclick="Update_character()">
                  <option value="">?</option>
                  <option value="ciko">Ciko</option>
                  <option value="cloe">Cloe</option>
                  <option value="pici catto">Pici Catto</option>
          </select><br>
                <br><button onclick="accept()">Accept</button></div>
                <div class="server" id="server">
                        <hr>
                        <br><button id="create-server" class="create-btn">üè† Create game</button><br>
                        <br><input type="text" id="code-value"><button id="join-server">üö™ Join game</button>
                </div>
</div>
        <div class="game">
                <div class="room" id="room">
                        <h2 id="room-code" data-code="">room code:</h2>
                        <button id="share-room" type="button" title="Share room">Share</button>
                        <script>
                        (function(){
                            const shareBtn = document.getElementById('share-room');
                            const roomEl = document.getElementById('room-code');
                        
                            // FIX: read from dataset, and stop if empty
                            function getRoomCode(){
                                const code = roomEl.dataset.code;
                                if(!code || code.trim() === ""){
                                    alert("Room code not set yet!");
                                    return null;
                                }
                                return code.trim();
                            }
                    
                            shareBtn.addEventListener('click', async () => {
                        
                                const code = getRoomCode();
                                if(!code) return; // stop if no code
                        
                                const shareText = 'Join my CIKOIN room: ' + code;
                                const shareUrl = `${location.origin}${location.pathname}?room=${encodeURIComponent(code)}`;
                        
                                try {
                                    if (navigator.share){
                                        await navigator.share({ title: 'CIKOIN ‚Äî Join room', text: shareText, url: shareUrl });
                                    } else if (navigator.clipboard && navigator.clipboard.writeText){
                                        await navigator.clipboard.writeText(shareUrl);
                                        alert('Room link copied to clipboard');
                                    } else {
                                        const ta = document.createElement('textarea');
                                        ta.value = shareUrl;
                                        document.body.appendChild(ta);
                                        ta.select();
                                        document.execCommand('copy');
                                        ta.remove();
                                        alert('Room link copied to clipboard');
                                    }
                                } catch (err){
                                    console.error(err);
                                    alert('Unable to share automatically.\nLink:\n' + shareUrl);
                                }
                            });
                        })();
                        </script>

                        <div class="players" id="players"></div>
                        <br><br><button class="start_match" id="start_match">Start</button>
                </div>
        </div>



</body> 
        <script type="module" src="JS/database.js"></script>
        <script src="JS/menu.js"></script>
        <script src="JS/game.js"></script>
        <script src="JS/loader.js"></script>
        <script src="JS/sounds.js"></script>
</html>